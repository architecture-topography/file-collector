version: 2
jobs:
  build:
    docker:
      - image: circleci/node:8.12
    steps:
      - checkout
      - run:
          name: "Install requirements"
          command: |
            yarn install
      - run:
          name: "Run Unit Tests"
          command: |
            yarn test
      - run:
          name: "Package into binaries"
          command: |
            yarn package
      - persist_to_workspace:
          root: ./
          paths:
            - packaged/*


  release:
    docker:
      - image: tsub/ghr
    steps:
      - attach_workspace:
          at: ./
      - run: ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME v0.0.$CIRCLE_BUILD_NUM packaged

workflows:
  version: 2
  build_and_release:
      jobs:
        - build
        # - release:
        #     requires:
        #       - build
